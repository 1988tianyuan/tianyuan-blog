title: 《深入理解计算机系统》读书笔记——Chapter 7(1)
author: 天渊
tags:
  - csapp
categories:
  - 读书笔记
date: 2019-10-28 23:24:00
---
### 《深入理解计算机系统》读书笔记——Chapter 7 （1）



本章主要介绍计算机系统中的异常处理流，当程序执行出错出现异常后，由硬件层，操作系统或者应用程序产生异常控制流对异常进行处理
<!--more-->

### 异常

计算机系统中使用`异常`（exception）的形式来实现异常控制流，比较简单的例子是，当CPU执行到某个指令后，执行状态发生变化，立即产生一个异常事件，这种事件有可能是内存缺页，甚至是某个指令试图除以0。产生事件后，CPU会通过`异常表`进行`异常过程调用`，由`Exception Handler`来专门处理这个异常事件

#### 异常表

系统中为每种类型的异常都分配了`异常号`，产生异常事件后，处理器执行异常过程调用时需要用这个异常号来从异常表中检索相应的`异常处理程序`，然后根据检索到的`异常处理程序`来执行相应的命令，跟一般的过程调用大同小异，不过还是有些区别：

- 异常过程调用的返回地址会根据异常的类型来判断，要么是返回当前正在执行的指令地址，要么是下一条指令的地址
- CPU会把一些额外的处理器状态压到栈里
- CPU在内核态中执行异常过程调用，会将上下文全部压到`内核栈`中
- 由于异常过程调用是运行在`内核态`下，因此这个过程对所有系统资源都有完全的访问权限

异常过程调用完成后，执行一条`从中断返回`的指令，将适当的状态弹回到处理器的控制和数据寄存器，如果中断的是用户态程序，则将上下文切换回用户态，控制返回给被中断的用户态应用程序

#### 四种异常类型

计算机系统将可能出现的异常分为四类：

- `中断`：对外部IO设备信号的响应，相对于正在执行的指令来说是异步发生的，由专门的`中断处理器(interrupt handler)`来处理这类中断信号

  中断类型跟其他三种异常还不太一样，中断不是由当前执行的指令产生的，IO设备通过向CPU的中断引脚发信号并将中断号发到总线上，CPU执行完当前指令后注意到中断引脚的电压变高，从系统总线读取中断号然后调用对应的中断处理器，调用完成后**返回到下一条指令**，就当这个中断从未发生过

- `陷阱`：

- `故障`：

- `终止`：